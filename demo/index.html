<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Atticus Demo - Voice-Controlled UI</title>
        <!-- Bulma CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
        />
        <!-- Font Awesome for icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        />
        <style>
            body {
                background-color: #191919;
                min-height: 100vh;
            }
            .hero {
                background: linear-gradient(135deg, #eadb66 0%, #a26c4b 100%);
            }
            .card {
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .status-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 8px;
            }
            .status-dot.idle {
                background-color: #b5b5b5;
            }
            .status-dot.connecting {
                background-color: #ffdd57;
                animation: pulse 1s infinite;
            }
            .status-dot.connected {
                background-color: #48c78e;
            }
            .status-dot.error {
                background-color: #f14668;
            }
            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }
            .conversation-box {
                max-height: 300px;
                overflow-y: auto;
                background: #fafafa;
                border-radius: 8px;
                padding: 1rem;
            }
            .message {
                margin-bottom: 1rem;
                padding: 0.75rem 1rem;
                border-radius: 12px;
                max-width: 85%;
            }
            .message.user {
                background: #667eea;
                color: white;
                margin-left: auto;
            }
            .message.assistant {
                background: #e8e8e8;
                color: #363636;
            }
            .message .role {
                font-size: 0.75rem;
                font-weight: 600;
                margin-bottom: 0.25rem;
                opacity: 0.8;
            }
            .action-log {
                max-height: 200px;
                overflow-y: auto;
                font-family: "Monaco", "Menlo", monospace;
                font-size: 0.85rem;
                background: #1e1e1e;
                color: #d4d4d4;
                padding: 1rem;
                border-radius: 8px;
            }
            .action-entry {
                margin-bottom: 0.75rem;
                padding-bottom: 0.75rem;
                border-bottom: 1px solid #333;
            }
            .action-entry:last-child {
                border-bottom: none;
            }
            .action-text {
                color: #9cdcfe;
            }
            .action-code {
                color: #ce9178;
                margin-top: 0.25rem;
            }
            .action-result {
                color: #6a9955;
                margin-top: 0.25rem;
            }
            .action-error {
                color: #f44747;
            }
            .speaking-bars {
                display: flex;
                gap: 3px;
                align-items: center;
            }
            .speaking-bar {
                width: 4px;
                height: 16px;
                background: #667eea;
                border-radius: 2px;
                animation: speaking 0.5s ease-in-out infinite;
            }
            .speaking-bar:nth-child(2) {
                animation-delay: 0.1s;
            }
            .speaking-bar:nth-child(3) {
                animation-delay: 0.2s;
            }
            .speaking-bar:nth-child(4) {
                animation-delay: 0.3s;
            }
            @keyframes speaking {
                0%,
                100% {
                    transform: scaleY(0.5);
                }
                50% {
                    transform: scaleY(1);
                }
            }
            pre.curl-example {
                background: #2d2d2d;
                color: #f8f8f2;
                padding: 1rem;
                border-radius: 8px;
                overflow-x: auto;
                font-size: 0.85rem;
            }
        </style>
    </head>
    <body>
        <!-- Hero Section -->
        <section class="hero is-primary is-small">
            <div class="hero-body">
                <div class="container">
                    <h1 class="title">
                        <i class="fas fa-microphone"></i> Atticus Demo
                    </h1>
                    <p class="subtitle">
                        Voice-controlled UI powered by OpenAI Realtime API
                    </p>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div class="columns">
                    <!-- Left Column: Connection & Form -->
                    <div class="column is-7">
                        <!-- Connection Card -->
                        <div class="card mb-5">
                            <header class="card-header">
                                <p class="card-header-title">
                                    <i class="fas fa-plug mr-2"></i> Connection
                                </p>
                            </header>
                            <div class="card-content">
                                <div class="field">
                                    <label class="label"
                                        >Client Secret (Ephemeral Key)</label
                                    >
                                    <div class="control has-icons-left">
                                        <input
                                            class="input"
                                            type="password"
                                            id="clientSecret"
                                            placeholder="ek_..."
                                        />
                                        <span class="icon is-left">
                                            <i class="fas fa-key"></i>
                                        </span>
                                    </div>
                                    <p class="help">
                                        Get this from OpenAI API - see curl
                                        example below
                                    </p>
                                </div>

                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label"
                                                >Language</label
                                            >
                                            <div class="control">
                                                <div
                                                    class="select is-fullwidth"
                                                >
                                                    <select id="language">
                                                        <option value="en">
                                                            English
                                                        </option>
                                                        <option value="hi">
                                                            Hindi
                                                        </option>
                                                        <option value="es">
                                                            Spanish
                                                        </option>
                                                        <option value="fr">
                                                            French
                                                        </option>
                                                        <option value="de">
                                                            German
                                                        </option>
                                                        <option value="it">
                                                            Italian
                                                        </option>
                                                        <option value="pt">
                                                            Portuguese
                                                        </option>
                                                        <option value="ru">
                                                            Russian
                                                        </option>
                                                        <option value="ja">
                                                            Japanese
                                                        </option>
                                                        <option value="ko">
                                                            Korean
                                                        </option>
                                                        <option value="zh">
                                                            Chinese
                                                        </option>
                                                        <option value="ar">
                                                            Arabic
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Voice</label>
                                            <div class="control">
                                                <div
                                                    class="select is-fullwidth"
                                                >
                                                    <select id="voice">
                                                        <option value="alloy">
                                                            Alloy (Neutral)
                                                        </option>
                                                        <option value="ash">
                                                            Ash (Soft)
                                                        </option>
                                                        <option value="ballad">
                                                            Ballad (Warm)
                                                        </option>
                                                        <option value="coral">
                                                            Coral (Clear)
                                                        </option>
                                                        <option value="echo">
                                                            Echo (Smooth)
                                                        </option>
                                                        <option value="sage">
                                                            Sage (Calm)
                                                        </option>
                                                        <option
                                                            value="shimmer"
                                                            selected
                                                        >
                                                            Shimmer (Bright)
                                                        </option>
                                                        <option value="verse">
                                                            Verse (Articulate)
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="field">
                                    <div class="control">
                                        <button
                                            id="connectBtn"
                                            class="button is-primary is-medium is-fullwidth"
                                        >
                                            <span class="icon">
                                                <i class="fas fa-play"></i>
                                            </span>
                                            <span>Connect</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="level mt-4">
                                    <div class="level-left">
                                        <div class="level-item">
                                            <span
                                                class="tag is-medium"
                                                id="statusTag"
                                            >
                                                <span
                                                    class="status-dot idle"
                                                    id="statusDot"
                                                ></span>
                                                <span id="statusText"
                                                    >Idle</span
                                                >
                                            </span>
                                        </div>
                                        <div class="level-item">
                                            <span
                                                id="speakingState"
                                                class="has-text-grey"
                                            ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Card -->
                        <div class="card" id="formContainer">
                            <header class="card-header">
                                <p class="card-header-title">
                                    <i class="fas fa-edit mr-2"></i> Contact
                                    Form
                                </p>
                            </header>
                            <div class="card-content">
                                <p class="mb-4 has-text-grey">
                                    Try saying: "Fill the first name with John"
                                    or "Set email to john@example.com"
                                </p>

                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label"
                                                >First Name</label
                                            >
                                            <div class="control">
                                                <input
                                                    class="input"
                                                    type="text"
                                                    id="firstName"
                                                    placeholder="John"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label"
                                                >Last Name</label
                                            >
                                            <div class="control">
                                                <input
                                                    class="input"
                                                    type="text"
                                                    id="lastName"
                                                    placeholder="Doe"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Email</label>
                                            <div class="control has-icons-left">
                                                <input
                                                    class="input"
                                                    type="email"
                                                    id="email"
                                                    placeholder="john@example.com"
                                                />
                                                <span class="icon is-left">
                                                    <i
                                                        class="fas fa-envelope"
                                                    ></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label">Phone</label>
                                            <div class="control has-icons-left">
                                                <input
                                                    class="input"
                                                    type="tel"
                                                    id="phone"
                                                    placeholder="+1 234 567 8900"
                                                />
                                                <span class="icon is-left">
                                                    <i class="fas fa-phone"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="columns">
                                    <div class="column">
                                        <div class="field">
                                            <label class="label"
                                                >Department</label
                                            >
                                            <div class="control">
                                                <div
                                                    class="select is-fullwidth"
                                                >
                                                    <select id="department">
                                                        <option value="">
                                                            Select department...
                                                        </option>
                                                        <option value="sales">
                                                            Sales
                                                        </option>
                                                        <option value="support">
                                                            Support
                                                        </option>
                                                        <option
                                                            value="engineering"
                                                        >
                                                            Engineering
                                                        </option>
                                                        <option
                                                            value="marketing"
                                                        >
                                                            Marketing
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <div class="field">
                                            <label class="label"
                                                >Priority</label
                                            >
                                            <div class="control">
                                                <div
                                                    class="select is-fullwidth"
                                                >
                                                    <select id="priority">
                                                        <option value="">
                                                            Select priority...
                                                        </option>
                                                        <option value="low">
                                                            Low
                                                        </option>
                                                        <option value="medium">
                                                            Medium
                                                        </option>
                                                        <option value="high">
                                                            High
                                                        </option>
                                                        <option value="urgent">
                                                            Urgent
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="field">
                                    <label class="label">Message</label>
                                    <div class="control">
                                        <textarea
                                            class="textarea"
                                            id="message"
                                            placeholder="Enter your message..."
                                        ></textarea>
                                    </div>
                                </div>

                                <div class="field is-grouped">
                                    <div class="control">
                                        <button
                                            id="submitBtn"
                                            class="button is-primary"
                                        >
                                            <span class="icon"
                                                ><i
                                                    class="fas fa-paper-plane"
                                                ></i
                                            ></span>
                                            <span>Submit</span>
                                        </button>
                                    </div>
                                    <div class="control">
                                        <button
                                            id="clearBtn"
                                            class="button is-light"
                                        >
                                            <span class="icon"
                                                ><i class="fas fa-eraser"></i
                                            ></span>
                                            <span>Clear</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Conversation & Actions -->
                    <div class="column is-5">
                        <!-- Conversation Card -->
                        <div class="card mb-5">
                            <header class="card-header">
                                <p class="card-header-title">
                                    <i class="fas fa-comments mr-2"></i>
                                    Conversation
                                </p>
                            </header>
                            <div class="card-content">
                                <div
                                    id="speakingIndicator"
                                    class="notification is-info is-light mb-3"
                                    style="display: none"
                                >
                                    <div class="is-flex is-align-items-center">
                                        <div class="speaking-bars mr-3">
                                            <div class="speaking-bar"></div>
                                            <div class="speaking-bar"></div>
                                            <div class="speaking-bar"></div>
                                            <div class="speaking-bar"></div>
                                        </div>
                                        <span id="speakingText"
                                            >AI is speaking...</span
                                        >
                                    </div>
                                </div>
                                <div class="conversation-box" id="conversation">
                                    <p class="has-text-grey has-text-centered">
                                        <i
                                            class="fas fa-comment-slash mr-2"
                                        ></i>
                                        No messages yet. Connect and start
                                        talking!
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Log Card -->
                        <div class="card mb-5">
                            <header class="card-header">
                                <p class="card-header-title">
                                    <i class="fas fa-bolt mr-2"></i> Action Log
                                </p>
                            </header>
                            <div class="card-content">
                                <div class="action-log" id="actionLog">
                                    <span class="has-text-grey"
                                        >UI actions will appear here...</span
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- How to Get Client Secret -->
                        <div class="card">
                            <header class="card-header">
                                <p class="card-header-title">
                                    <i class="fas fa-terminal mr-2"></i> Get
                                    Client Secret
                                </p>
                            </header>
                            <div class="card-content">
                                <p class="mb-3">
                                    Run this curl command to get an ephemeral
                                    client secret:
                                </p>
                                <pre class="curl-example">
curl -X POST "https://api.openai.com/v1/realtime/sessions" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o-realtime-preview-2024-12-17",
    "voice": "shimmer"
  }'</pre
                                >
                                <p class="mt-3 has-text-grey is-size-7">
                                    Copy the
                                    <code>client_secret.value</code> from the
                                    response and paste above.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Atticus via CDN -->
        <script src="https://cdn.jsdelivr.net/npm/@rajnandan1/atticus@latest/dist/index.global.js"></script>
        <!-- For local development, use: -->
        <!-- <script src="../dist/index.global.js"></script> -->

        <script>
            // Atticus is available globally after loading the script
            console.log("Atticus loaded:", Atticus);

            // DOM Elements
            const clientSecretInput = document.getElementById("clientSecret");
            const languageSelect = document.getElementById("language");
            const voiceSelect = document.getElementById("voice");
            const connectBtn = document.getElementById("connectBtn");
            const statusDot = document.getElementById("statusDot");
            const statusText = document.getElementById("statusText");
            const speakingState = document.getElementById("speakingState");
            const speakingIndicator =
                document.getElementById("speakingIndicator");
            const speakingTextEl = document.getElementById("speakingText");
            const conversation = document.getElementById("conversation");
            const actionLog = document.getElementById("actionLog");
            const formContainer = document.getElementById("formContainer");
            const submitBtn = document.getElementById("submitBtn");
            const clearBtn = document.getElementById("clearBtn");

            let agent = null;

            // Update status indicator
            function updateStatus(status) {
                statusDot.className = "status-dot " + status;
                const statusLabels = {
                    idle: "Idle",
                    connecting: "Connecting...",
                    connected: "Connected",
                    error: "Error",
                };
                statusText.textContent = statusLabels[status] || status;

                // Update button
                if (status === "connected") {
                    connectBtn.innerHTML =
                        '<span class="icon"><i class="fas fa-stop"></i></span><span>Disconnect</span>';
                    connectBtn.className =
                        "button is-danger is-medium is-fullwidth";
                    connectBtn.disabled = false;
                } else if (status === "connecting") {
                    connectBtn.innerHTML =
                        '<span class="icon"><i class="fas fa-spinner fa-spin"></i></span><span>Connecting...</span>';
                    connectBtn.disabled = true;
                } else {
                    connectBtn.innerHTML =
                        '<span class="icon"><i class="fas fa-play"></i></span><span>Connect</span>';
                    connectBtn.className =
                        "button is-primary is-medium is-fullwidth";
                    connectBtn.disabled = false;
                }
            }

            // Update conversation state
            function updateConversationState(state) {
                const stateLabels = {
                    idle: "",
                    ai_speaking: "üîä AI Speaking",
                    user_turn: "üé§ Your turn",
                    user_speaking: "üéôÔ∏è Listening...",
                };
                speakingState.textContent = stateLabels[state] || "";

                if (state === "ai_speaking") {
                    speakingIndicator.style.display = "block";
                    speakingTextEl.textContent = "AI is speaking...";
                } else if (state === "user_speaking") {
                    speakingIndicator.style.display = "block";
                    speakingTextEl.textContent = "Listening...";
                } else {
                    speakingIndicator.style.display = "none";
                }
            }

            // Add message to conversation
            function addMessage(message) {
                // Clear placeholder
                const placeholder =
                    conversation.querySelector("p.has-text-grey");
                if (placeholder) conversation.innerHTML = "";

                const div = document.createElement("div");
                div.className = "message " + message.role;

                const role = document.createElement("div");
                role.className = "role";
                role.textContent =
                    message.role === "user" ? "You" : "Assistant";

                const content = document.createElement("div");
                content.textContent =
                    message.content.type === "text"
                        ? message.content.text
                        : message.content.transcript || "(audio)";

                div.appendChild(role);
                div.appendChild(content);
                conversation.appendChild(div);
                conversation.scrollTop = conversation.scrollHeight;
            }

            // Log action
            function logAction(action, result) {
                // Clear placeholder
                const placeholder =
                    actionLog.querySelector("span.has-text-grey");
                if (placeholder) actionLog.innerHTML = "";

                const entry = document.createElement("div");
                entry.className = "action-entry";
                entry.innerHTML = `
                    <div class="action-text">üì¢ ${action.outputText}</div>
                    ${
                        action.outputCode
                            ? `<div class="action-code">‚ö° ${action.outputCode}</div>`
                            : ""
                    }
                    ${
                        result
                            ? `<div class="${
                                  result.success
                                      ? "action-result"
                                      : "action-error"
                              }">
                        ${result.success ? "‚úì Success" : "‚úó " + result.error}
                    </div>`
                            : ""
                    }
                `;
                actionLog.appendChild(entry);
                actionLog.scrollTop = actionLog.scrollHeight;
            }

            // Connect/disconnect
            async function toggleConnection() {
                if (agent && agent.isConnected) {
                    agent.disconnect();
                    agent = null;
                    return;
                }

                const clientSecret = clientSecretInput.value.trim();
                if (!clientSecret) {
                    alert(
                        "Please enter a client secret. See the curl command below to get one."
                    );
                    return;
                }

                try {
                    // Create Atticus instance using global Atticus.Atticus
                    agent = new Atticus.Atticus({
                        clientSecret,
                        language: languageSelect.value,
                        voice: voiceSelect.value,
                        agent: {
                            name: "Form Assistant",
                            instructions: `You are a helpful assistant that helps users fill out a contact form.

The form has these fields:
- First Name (id: firstName)
- Last Name (id: lastName)
- Email (id: email)
- Phone (id: phone)
- Department (id: department) - options: sales, support, engineering, marketing
- Priority (id: priority) - options: low, medium, high, urgent
- Message (id: message) - textarea

When the user asks to fill a field, use the execute_ui_action tool to set the value.
Be friendly and confirm what you've done.`,
                        },
                        debug: true,
                        ui: {
                            enabled: true,
                            rootElement: formContainer,
                            autoUpdate: true,
                            autoUpdateInterval: 3000,
                        },
                    });

                    // Event listeners
                    agent.on("statusChange", updateStatus);
                    agent.on(
                        "conversationStateChange",
                        updateConversationState
                    );
                    agent.on("message", addMessage);
                    agent.on("error", (err) => {
                        console.error("Error:", err);
                        alert("Error: " + err);
                    });
                    agent.on("action", (action) => {
                        console.log("Action executed:", action);
                        logAction(action, { success: true });
                    });

                    await agent.connect();
                    console.log("Connected successfully!");
                } catch (err) {
                    console.error("Connection failed:", err);
                    alert("Connection failed: " + err.message);
                }
            }

            // Event listeners
            connectBtn.addEventListener("click", toggleConnection);

            submitBtn.addEventListener("click", () => {
                const formData = {
                    firstName: document.getElementById("firstName").value,
                    lastName: document.getElementById("lastName").value,
                    email: document.getElementById("email").value,
                    phone: document.getElementById("phone").value,
                    department: document.getElementById("department").value,
                    priority: document.getElementById("priority").value,
                    message: document.getElementById("message").value,
                };
                console.log("Form submitted:", formData);
                alert("Form submitted! Check console for data.");
            });

            clearBtn.addEventListener("click", () => {
                [
                    "firstName",
                    "lastName",
                    "email",
                    "phone",
                    "department",
                    "priority",
                    "message",
                ].forEach((id) => {
                    document.getElementById(id).value = "";
                });
            });

            // Allow Enter key to connect
            clientSecretInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") toggleConnection();
            });
        </script>
    </body>
</html>
